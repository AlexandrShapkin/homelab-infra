- name: Установка зависимостей python3
  dnf:
    name:
      - python3-pip
      - python3-packaging
    state: present

- name: Установка зависимостей community.docker
  pip:
    name:
      - docker
      - requests
    executable: "{{ pip_path }}"

- name: Проверка и создание Docker-сетей
  ansible.builtin.shell: |
    if ! docker network ls --filter name=^{{ item.name }}$ --format '{{'{{'}}.Name{{'}}'}}' | grep -q '^{{ item.name }}$'; then
      docker network create --driver bridge --subnet {{ item.ip }} {% if item.internal | default(false) %}--internal{% endif %} {{ item.name }}
    fi
  loop: "{{ docker_networks }}"
  loop_control:
    label: "{{ item.name }}"

